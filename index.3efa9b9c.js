const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.restart()}moveLeft(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.board[e].filter(t=>0!==t),a=[];for(let e=0;e<s.length;e++)s[e]===s[e+1]?(a.push(2*s[e]),this.score+=2*s[e],e++,t=!0):a.push(s[e]);for(;a.length<4;)a.push(0);this.board[e].toString()!==a.toString()&&(this.board[e]=a,t=!0)}t&&this.addRandomTile(),this.checkGameOver()}moveRight(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.board[e].filter(t=>0!==t).reverse(),a=[],i=0;for(;i<s.length;)s[i]===s[i+1]?(a.push(2*s[i]),this.score+=2*s[i],i+=2,t=!0):(a.push(s[i]),i++);for(;a.length<4;)a.push(0);a.reverse(),this.board[e].toString()!==a.toString()&&(this.board[e]=a,t=!0)}t&&this.addRandomTile(),this.checkGameOver()}moveUp(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=[];for(let t=0;t<4;t++)0!==this.board[t][e]&&s.push(this.board[t][e]);let a=[],i=0;for(;i<s.length;)s[i]===s[i+1]?(a.push(2*s[i]),this.score+=2*s[i],i+=2):(a.push(s[i]),i++);for(;a.length<4;)a.push(0);for(let s=0;s<4;s++)this.board[s][e]!==a[s]&&(t=!0),this.board[s][e]=a[s]}t&&this.addRandomTile(),this.checkGameOver()}moveDown(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=[];for(let t=0;t<4;t++)0!==this.board[t][e]&&s.push(this.board[t][e]);let a=[],i=s.length-1;for(;i>=0;)s[i]===s[i-1]?(a.unshift(2*s[i]),this.score+=2*s[i],i-=2,t=!0):(a.unshift(s[i]),i--);for(;a.length<4;)a.unshift(0);for(let s=0;s<4;s++)this.board[s][e]!==a[s]&&(t=!0),this.board[s][e]=a[s]}t&&this.addRandomTile(),this.checkGameOver()}getScore(){return this.score}getState(){return this.board.map(t=>[...t])}getStatus(){return this.status}start(){this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.board=this.initialState.map(t=>[...t]),this.score=0,this.status="idle"}checkGameOver(){this.board.some(t=>t.includes(2048))?this.status="win":this.canMove()||(this.status="lose")}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e]||e<3&&this.board[t][e]===this.board[t][e+1]||t<3&&this.board[t][e]===this.board[t+1][e])return!0;return!1}addRandomTile(){let t=[];if(this.board.forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push({rowIndex:s,colIndex:a})})}),t.length>0){let e=Math.floor(Math.random()*t.length),{rowIndex:s,colIndex:a}=t[e];this.board[s][a]=.9>Math.random()?2:4;let i=document.querySelector(`[data-position="${s}-${a}"]`);requestAnimationFrame(()=>{i.classList.add("field-cell--new"),setTimeout(()=>{i.classList.remove("field-cell--new")},300)})}}},e=document.querySelector(".game-score"),s=document.getElementById("startButton"),a=document.querySelector(".message-start"),i=document.querySelector(".message-win"),r=document.querySelector(".message-lose"),d=document.querySelector(".message-playing");function o(){t.getState().forEach((t,e)=>{t.forEach((t,s)=>{let a=document.querySelector(`[data-position="${e}-${s}"]`);a.textContent=0!==t?t:"",a.className="field-cell",0!==t&&a.classList.add(`field-cell--${t}`)})})}function n(){e.textContent=t.getScore()}function h(){let e=t.getStatus();"win"===e?(i.classList.remove("hidden"),r.classList.add("hidden"),a.classList.add("hidden"),d.classList.add("hidden")):"lose"===e?(r.classList.remove("hidden"),i.classList.add("hidden"),a.classList.add("hidden"),d.classList.add("hidden")):"playing"===e?(d.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden"),r.classList.add("hidden")):(a.classList.remove("hidden"),i.classList.add("hidden"),r.classList.add("hidden"),d.classList.add("hidden"))}s.addEventListener("click",()=>{s.classList.contains("start")?(t.start(),o(),h(),s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart"):(t.restart(),o(),n(),h(),s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start")}),window.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}o(),n(),h()});
//# sourceMappingURL=index.3efa9b9c.js.map
